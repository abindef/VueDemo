<template>
  <div class="demo-container">
    <h2>2ï¸âƒ£ è®¡ç®—å±æ€§ä¸ä¾¦å¬å™¨</h2>
    <p class="intro">è®¡ç®—å±æ€§ç”¨äºåŸºäºå“åº”å¼æ•°æ®æ´¾ç”Ÿæ–°å€¼ï¼Œä¾¦å¬å™¨ç”¨äºå“åº”æ•°æ®å˜åŒ–æ‰§è¡Œå‰¯ä½œç”¨</p>

    <div class="demo-section">
      <h3>ğŸ“Œ computed - è®¡ç®—å±æ€§</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>è´­ç‰©è½¦ç¤ºä¾‹</h4>
          <div v-for="item in cart" :key="item.id" class="cart-item">
            <span>{{ item.name }}</span>
            <span>Â¥{{ item.price }} Ã— {{ item.quantity }}</span>
            <button @click="item.quantity++">+</button>
            <button @click="item.quantity > 1 && item.quantity--">-</button>
          </div>
          <div class="total">
            <p>å•†å“æ€»æ•°: <strong>{{ totalQuantity }}</strong></p>
            <p>æ€»ä»·: <strong>Â¥{{ totalPrice }}</strong></p>
            <p>æŠ˜æ‰£å: <strong>Â¥{{ discountedPrice }}</strong></p>
          </div>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li><code>computed()</code> åˆ›å»ºè®¡ç®—å±æ€§</li>
            <li>åŸºäºå“åº”å¼ä¾èµ–è‡ªåŠ¨è®¡ç®—</li>
            <li>ç»“æœä¼šè¢«ç¼“å­˜ï¼Œä¾èµ–ä¸å˜ä¸ä¼šé‡æ–°è®¡ç®—</li>
            <li>æ¯”æ–¹æ³•è°ƒç”¨æ›´é«˜æ•ˆ</li>
            <li>åªè¯»ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ å¯å†™è®¡ç®—å±æ€§</h3>
      <div class="code-demo">
        <div class="demo-box">
          <p>å: <input v-model="firstName" /></p>
          <p>å§“: <input v-model="lastName" /></p>
          <p>å…¨å: <input v-model="fullName" /></p>
          <p class="result">æ˜¾ç¤º: <strong>{{ fullName }}</strong></p>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>è®¡ç®—å±æ€§å¯ä»¥æä¾› getter å’Œ setter</li>
            <li>getter ç”¨äºè¯»å–å€¼</li>
            <li>setter ç”¨äºè®¾ç½®å€¼æ—¶çš„é€»è¾‘</li>
            <li>å®ç°åŒå‘æ•°æ®æµ</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ watch - ä¾¦å¬å™¨</h3>
      <div class="code-demo">
        <div class="demo-box">
          <p>æœç´¢: <input v-model="searchQuery" placeholder="è¾“å…¥æœç´¢å†…å®¹..." /></p>
          <p>æœç´¢æ¬¡æ•°: <strong>{{ searchCount }}</strong></p>
          <div class="log-box">
            <p v-for="(log, index) in searchLogs" :key="index">{{ log }}</p>
          </div>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li><code>watch()</code> ä¾¦å¬å“åº”å¼æ•°æ®å˜åŒ–</li>
            <li>å¯ä»¥è®¿é—®æ–°å€¼å’Œæ—§å€¼</li>
            <li>é€‚åˆæ‰§è¡Œå¼‚æ­¥æ“ä½œæˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œ</li>
            <li>å¯ä»¥ä¾¦å¬å¤šä¸ªæ•°æ®æº</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ watchEffect - è‡ªåŠ¨ä¾¦å¬</h3>
      <div class="code-demo">
        <div class="demo-box">
          <p>X: <input type="number" v-model.number="x" /></p>
          <p>Y: <input type="number" v-model.number="y" /></p>
          <p class="result">X + Y = <strong>{{ sum }}</strong></p>
          <p class="info">watchEffect è‡ªåŠ¨è¿½è¸ªäº† x å’Œ y çš„å˜åŒ–</p>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li><code>watchEffect()</code> è‡ªåŠ¨è¿½è¸ªä¾èµ–</li>
            <li>ç«‹å³æ‰§è¡Œä¸€æ¬¡</li>
            <li>ä¸éœ€è¦æ˜ç¡®æŒ‡å®šä¾¦å¬çš„æ•°æ®</li>
            <li>é€‚åˆç®€å•çš„å‰¯ä½œç”¨é€»è¾‘</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="code-block">
      <h3>ğŸ“ æ ¸å¿ƒä»£ç ç¤ºä¾‹</h3>
      <pre><code>import { ref, computed, watch, watchEffect } from 'vue'

// 1. åªè¯»è®¡ç®—å±æ€§
const count = ref(0)
const double = computed(() => count.value * 2)

// 2. å¯å†™è®¡ç®—å±æ€§
const firstName = ref('å¼ ')
const lastName = ref('ä¸‰')
const fullName = computed({
  get: () => firstName.value + lastName.value,
  set: (val) => {
    [firstName.value, lastName.value] = val.split(' ')
  }
})

// 3. watch ä¾¦å¬å™¨
watch(count, (newVal, oldVal) => {
  console.log(`count ä» ${oldVal} å˜ä¸º ${newVal}`)
})

// 4. watchEffect è‡ªåŠ¨ä¾¦å¬
watchEffect(() => {
  console.log('count çš„å€¼æ˜¯:', count.value)
})</code></pre>
    </div>

    <div class="tips-box">
      <h3>ğŸ¯ æœ€ä½³å®è·µ</h3>
      <ul>
        <li><strong>è®¡ç®—å±æ€§ vs æ–¹æ³•ï¼š</strong>è®¡ç®—å±æ€§æœ‰ç¼“å­˜ï¼Œæ€§èƒ½æ›´å¥½</li>
        <li><strong>watch vs watchEffectï¼š</strong>éœ€è¦æ—§å€¼ç”¨ watchï¼Œå¦åˆ™ç”¨ watchEffect</li>
        <li><strong>é¿å…å‰¯ä½œç”¨ï¼š</strong>è®¡ç®—å±æ€§ä¸­ä¸è¦ä¿®æ”¹å…¶ä»–çŠ¶æ€</li>
        <li><strong>å¼‚æ­¥æ“ä½œï¼š</strong>åœ¨ watch ä¸­æ‰§è¡Œï¼Œä¸åœ¨ computed ä¸­</li>
      </ul>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, watch, watchEffect } from 'vue'

const cart = reactive([
  { id: 1, name: 'Vue3 æ•™ç¨‹', price: 99, quantity: 1 },
  { id: 2, name: 'JavaScript é«˜çº§', price: 129, quantity: 2 },
  { id: 3, name: 'TypeScript å®æˆ˜', price: 149, quantity: 1 }
])

const totalQuantity = computed(() => {
  const total = cart.reduce((sum, item) => sum + item.quantity, 0)
  console.log('è®¡ç®—æ€»æ•°é‡:', total)
  return total
})

const totalPrice = computed(() => {
  const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0)
  console.log('è®¡ç®—æ€»ä»·:', total)
  return total
})

const discountedPrice = computed(() => {
  const discount = totalPrice.value > 300 ? 0.9 : 1
  return Math.round(totalPrice.value * discount)
})

const firstName = ref('å¼ ')
const lastName = ref('ä¸‰')

const fullName = computed({
  get: () => {
    return firstName.value + ' ' + lastName.value
  },
  set: (val) => {
    const parts = val.split(' ')
    firstName.value = parts[0] || ''
    lastName.value = parts[1] || ''
  }
})

const searchQuery = ref('')
const searchCount = ref(0)
const searchLogs = ref([])

watch(searchQuery, (newVal, oldVal) => {
  searchCount.value++
  const log = `[${searchCount.value}] ä» "${oldVal}" å˜ä¸º "${newVal}"`
  searchLogs.value.unshift(log)
  if (searchLogs.value.length > 5) {
    searchLogs.value.pop()
  }
  console.log(log)
})

const x = ref(0)
const y = ref(0)
const sum = ref(0)

watchEffect(() => {
  sum.value = x.value + y.value
  console.log(`watchEffect: ${x.value} + ${y.value} = ${sum.value}`)
})
</script>

<style scoped>
.demo-container {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

h2 {
  color: #667eea;
  margin-bottom: 1rem;
  font-size: 2rem;
}

.intro {
  color: #666;
  font-size: 1.1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #667eea;
}

.demo-section {
  margin: 2rem 0;
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.demo-section h3 {
  color: #333;
  margin-bottom: 1rem;
}

.code-demo {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-top: 1rem;
}

.demo-box {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.demo-box h4 {
  color: #667eea;
  margin-bottom: 1rem;
}

.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.8rem;
  background: #f8f9fa;
  margin: 0.5rem 0;
  border-radius: 6px;
}

.cart-item button {
  padding: 0.3rem 0.8rem;
  margin-left: 0.3rem;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.total {
  margin-top: 1rem;
  padding: 1rem;
  background: #e8f4f8;
  border-radius: 6px;
  border-left: 4px solid #667eea;
}

.total p {
  margin: 0.5rem 0;
  color: #555;
}

.total strong {
  color: #667eea;
  font-size: 1.2rem;
}

.demo-box input {
  width: 100%;
  padding: 0.6rem;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  font-size: 1rem;
  margin: 0.5rem 0;
}

.demo-box input:focus {
  outline: none;
  border-color: #667eea;
}

.result {
  margin-top: 1rem;
  padding: 1rem;
  background: #e8f4f8;
  border-radius: 6px;
}

.result strong {
  color: #667eea;
  font-size: 1.2rem;
}

.log-box {
  margin-top: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 6px;
  max-height: 150px;
  overflow-y: auto;
}

.log-box p {
  margin: 0.3rem 0;
  color: #555;
  font-size: 0.9rem;
  font-family: monospace;
}

.info {
  margin-top: 1rem;
  padding: 0.8rem;
  background: #fff3cd;
  border-radius: 6px;
  color: #856404;
  font-size: 0.9rem;
}

.code-explanation {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.code-explanation h4 {
  color: #667eea;
  margin-bottom: 1rem;
}

.code-explanation ul {
  list-style: none;
  padding: 0;
}

.code-explanation li {
  padding: 0.5rem 0;
  color: #555;
  line-height: 1.6;
}

.code-explanation code {
  background: #f8f9fa;
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  color: #667eea;
  font-family: 'Courier New', monospace;
}

.code-block {
  margin: 2rem 0;
  background: #2d3748;
  padding: 1.5rem;
  border-radius: 8px;
  overflow-x: auto;
}

.code-block h3 {
  color: white;
  margin-bottom: 1rem;
}

.code-block pre {
  margin: 0;
}

.code-block code {
  color: #a0aec0;
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  line-height: 1.6;
}

.tips-box {
  background: #fff3cd;
  padding: 1.5rem;
  border-radius: 8px;
  border-left: 4px solid #ffc107;
  margin-top: 2rem;
}

.tips-box h3 {
  color: #856404;
  margin-bottom: 1rem;
}

.tips-box ul {
  list-style: none;
  padding: 0;
}

.tips-box li {
  padding: 0.5rem 0;
  color: #856404;
}

.tips-box strong {
  color: #533f03;
}

@media (max-width: 768px) {
  .code-demo {
    grid-template-columns: 1fr;
  }
}
</style>
