<template>
  <div class="demo-container">
    <h2>6ï¸âƒ£ ç»„åˆå¼ API (Composition API)</h2>
    <p class="intro">Composition API æä¾›äº†æ›´çµæ´»çš„ä»£ç ç»„ç»‡æ–¹å¼å’Œæ›´å¥½çš„é€»è¾‘å¤ç”¨èƒ½åŠ›</p>

    <div class="demo-section">
      <h3>ğŸ“Œ è‡ªå®šä¹‰ Hook - useCounter</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>è®¡æ•°å™¨ Hook</h4>
          <p>è®¡æ•°: <strong>{{ count }}</strong></p>
          <p>åŒå€: <strong>{{ doubleCount }}</strong></p>
          <button @click="increment">å¢åŠ </button>
          <button @click="decrement">å‡å°‘</button>
          <button @click="reset">é‡ç½®</button>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>å°†å¯å¤ç”¨çš„é€»è¾‘æå–åˆ°ç‹¬ç«‹å‡½æ•°</li>
            <li>è¿”å›å“åº”å¼æ•°æ®å’Œæ–¹æ³•</li>
            <li>å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¸­å¤ç”¨</li>
            <li>å‘½åçº¦å®šï¼šuse å¼€å¤´</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ è‡ªå®šä¹‰ Hook - useMouse</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>é¼ æ ‡ä½ç½®è¿½è¸ª</h4>
          <div class="mouse-tracker">
            <p>X: <strong>{{ x }}</strong></p>
            <p>Y: <strong>{{ y }}</strong></p>
            <div 
              class="cursor-dot" 
              :style="{ left: x + 'px', top: y + 'px' }"
            ></div>
          </div>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>å°è£…äº‹ä»¶ç›‘å¬é€»è¾‘</li>
            <li>è‡ªåŠ¨æ¸…ç†å‰¯ä½œç”¨</li>
            <li>åœ¨ onUnmounted ä¸­ç§»é™¤ç›‘å¬å™¨</li>
            <li>æé«˜ä»£ç å¯ç»´æŠ¤æ€§</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ è‡ªå®šä¹‰ Hook - useFetch</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>æ•°æ®è·å– Hook</h4>
          <button @click="fetchData">è·å–æ•°æ®</button>
          <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>
          <div v-else-if="error" class="error">é”™è¯¯: {{ error }}</div>
          <div v-else-if="data" class="data-box">
            <pre>{{ JSON.stringify(data, null, 2) }}</pre>
          </div>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>å°è£…å¼‚æ­¥è¯·æ±‚é€»è¾‘</li>
            <li>ç»Ÿä¸€å¤„ç†åŠ è½½ã€é”™è¯¯ã€æ•°æ®çŠ¶æ€</li>
            <li>å¯ä»¥æ·»åŠ ç¼“å­˜ã€é‡è¯•ç­‰åŠŸèƒ½</li>
            <li>æé«˜ä»£ç å¤ç”¨æ€§</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ è‡ªå®šä¹‰ Hook - useLocalStorage</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>æœ¬åœ°å­˜å‚¨ Hook</h4>
          <input v-model="storedValue" placeholder="è¾“å…¥å†…å®¹..." />
          <p>å­˜å‚¨çš„å€¼: <strong>{{ storedValue }}</strong></p>
          <button @click="clearStorage">æ¸…é™¤å­˜å‚¨</button>
          <p class="info">åˆ·æ–°é¡µé¢æ•°æ®ä¸ä¼šä¸¢å¤±</p>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>å°è£… localStorage æ“ä½œ</li>
            <li>è‡ªåŠ¨åŒæ­¥åˆ°æœ¬åœ°å­˜å‚¨</li>
            <li>æ”¯æŒ JSON åºåˆ—åŒ–</li>
            <li>å®ç°æ•°æ®æŒä¹…åŒ–</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="comparison">
      <h3>ğŸ“Š Options API vs Composition API</h3>
      <div class="comparison-grid">
        <div class="comparison-item">
          <h4>Options API</h4>
          <pre><code>export default {
  data() {
    return {
      count: 0
    }
  },
  computed: {
    double() {
      return this.count * 2
    }
  },
  methods: {
    increment() {
      this.count++
    }
  },
  mounted() {
    console.log('mounted')
  }
}</code></pre>
        </div>
        <div class="comparison-item">
          <h4>Composition API</h4>
          <pre><code>import { ref, computed, onMounted } from 'vue'

export default {
  setup() {
    const count = ref(0)
    
    const double = computed(() => 
      count.value * 2
    )
    
    const increment = () => {
      count.value++
    }
    
    onMounted(() => {
      console.log('mounted')
    })
    
    return { count, double, increment }
  }
}</code></pre>
        </div>
      </div>
    </div>

    <div class="code-block">
      <h3>ğŸ“ è‡ªå®šä¹‰ Hook ç¤ºä¾‹ä»£ç </h3>
      <pre><code>// useCounter.js
import { ref, computed } from 'vue'

export function useCounter(initialValue = 0) {
  const count = ref(initialValue)
  const doubleCount = computed(() => count.value * 2)
  
  const increment = () => count.value++
  const decrement = () => count.value--
  const reset = () => count.value = initialValue
  
  return {
    count,
    doubleCount,
    increment,
    decrement,
    reset
  }
}

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { useCounter } from './useCounter'

const { count, doubleCount, increment, decrement, reset } = useCounter(0)</code></pre>
    </div>

    <div class="tips-box">
      <h3>ğŸ¯ Composition API ä¼˜åŠ¿</h3>
      <ul>
        <li><strong>æ›´å¥½çš„é€»è¾‘å¤ç”¨ï¼š</strong>é€šè¿‡ç»„åˆå‡½æ•°å®ç°é€»è¾‘å¤ç”¨</li>
        <li><strong>æ›´å¥½çš„ç±»å‹æ¨å¯¼ï¼š</strong>æ›´å¥½çš„ TypeScript æ”¯æŒ</li>
        <li><strong>æ›´çµæ´»çš„ä»£ç ç»„ç»‡ï¼š</strong>æŒ‰åŠŸèƒ½ç»„ç»‡ä»£ç ï¼Œè€Œä¸æ˜¯é€‰é¡¹</li>
        <li><strong>æ›´å°çš„æ‰“åŒ…ä½“ç§¯ï¼š</strong>æ›´å¥½çš„ tree-shaking æ”¯æŒ</li>
        <li><strong>æ›´æ˜“äºæµ‹è¯•ï¼š</strong>çº¯å‡½æ•°æ›´å®¹æ˜“æµ‹è¯•</li>
      </ul>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue'

function useCounter(initialValue = 0) {
  const count = ref(initialValue)
  const doubleCount = computed(() => count.value * 2)
  
  const increment = () => {
    count.value++
    console.log('è®¡æ•°å¢åŠ :', count.value)
  }
  
  const decrement = () => {
    count.value--
    console.log('è®¡æ•°å‡å°‘:', count.value)
  }
  
  const reset = () => {
    count.value = initialValue
    console.log('è®¡æ•°é‡ç½®:', count.value)
  }
  
  return {
    count,
    doubleCount,
    increment,
    decrement,
    reset
  }
}

const { count, doubleCount, increment, decrement, reset } = useCounter(0)

function useMouse() {
  const x = ref(0)
  const y = ref(0)
  
  const update = (event) => {
    x.value = event.pageX
    y.value = event.pageY
  }
  
  onMounted(() => {
    window.addEventListener('mousemove', update)
    console.log('é¼ æ ‡è¿½è¸ªå·²å¯åŠ¨')
  })
  
  onUnmounted(() => {
    window.removeEventListener('mousemove', update)
    console.log('é¼ æ ‡è¿½è¸ªå·²åœæ­¢')
  })
  
  return { x, y }
}

const { x, y } = useMouse()

function useFetch() {
  const data = ref(null)
  const loading = ref(false)
  const error = ref(null)
  
  const fetchData = async () => {
    loading.value = true
    error.value = null
    
    try {
      await new Promise(resolve => setTimeout(resolve, 1000))
      
      data.value = {
        id: 1,
        title: 'Vue3 æ•™ç¨‹',
        author: 'å¼ ä¸‰',
        date: new Date().toLocaleDateString()
      }
      
      console.log('æ•°æ®è·å–æˆåŠŸ:', data.value)
    } catch (e) {
      error.value = e.message
      console.error('æ•°æ®è·å–å¤±è´¥:', e)
    } finally {
      loading.value = false
    }
  }
  
  return {
    data,
    loading,
    error,
    fetchData
  }
}

const { data, loading, error, fetchData } = useFetch()

function useLocalStorage(key, initialValue) {
  const storedValue = ref(initialValue)
  
  const loadFromStorage = () => {
    try {
      const item = window.localStorage.getItem(key)
      if (item) {
        storedValue.value = JSON.parse(item)
      }
    } catch (e) {
      console.error('è¯»å– localStorage å¤±è´¥:', e)
    }
  }
  
  const saveToStorage = (value) => {
    try {
      window.localStorage.setItem(key, JSON.stringify(value))
      console.log('ä¿å­˜åˆ° localStorage:', value)
    } catch (e) {
      console.error('ä¿å­˜ localStorage å¤±è´¥:', e)
    }
  }
  
  const clearStorage = () => {
    try {
      window.localStorage.removeItem(key)
      storedValue.value = initialValue
      console.log('æ¸…é™¤ localStorage')
    } catch (e) {
      console.error('æ¸…é™¤ localStorage å¤±è´¥:', e)
    }
  }
  
  onMounted(() => {
    loadFromStorage()
  })
  
  return {
    storedValue: computed({
      get: () => storedValue.value,
      set: (value) => {
        storedValue.value = value
        saveToStorage(value)
      }
    }),
    clearStorage
  }
}

const { storedValue, clearStorage } = useLocalStorage('vue-demo-storage', '')
</script>

<style scoped>
.demo-container {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

h2 {
  color: #667eea;
  margin-bottom: 1rem;
  font-size: 2rem;
}

.intro {
  color: #666;
  font-size: 1.1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #667eea;
}

.demo-section {
  margin: 2rem 0;
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.demo-section h3 {
  color: #333;
  margin-bottom: 1rem;
}

.code-demo {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-top: 1rem;
}

.demo-box {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.demo-box h4 {
  color: #667eea;
  margin-bottom: 1rem;
}

.demo-box p {
  margin: 0.5rem 0;
  color: #555;
}

.demo-box strong {
  color: #667eea;
  font-size: 1.2rem;
}

.demo-box button {
  margin: 0.5rem 0.5rem 0 0;
  padding: 0.6rem 1.2rem;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s;
}

.demo-box button:hover {
  background: #5568d3;
  transform: translateY(-2px);
}

.demo-box input {
  width: 100%;
  padding: 0.6rem;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  margin: 0.5rem 0;
  font-size: 1rem;
}

.demo-box input:focus {
  outline: none;
  border-color: #667eea;
}

.mouse-tracker {
  position: relative;
  height: 200px;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
  overflow: hidden;
}

.mouse-tracker p {
  position: absolute;
  top: 10px;
  left: 10px;
  margin: 0.3rem 0;
  z-index: 10;
}

.cursor-dot {
  position: fixed;
  width: 20px;
  height: 20px;
  background: #667eea;
  border-radius: 50%;
  pointer-events: none;
  transform: translate(-50%, -50%);
  z-index: 9999;
  box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
}

.loading {
  padding: 2rem;
  text-align: center;
  color: #667eea;
  font-weight: bold;
}

.error {
  padding: 1rem;
  background: #f8d7da;
  color: #721c24;
  border-radius: 6px;
  margin: 1rem 0;
}

.data-box {
  margin: 1rem 0;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 6px;
  max-height: 200px;
  overflow-y: auto;
}

.data-box pre {
  margin: 0;
  color: #555;
  font-size: 0.9rem;
}

.info {
  margin-top: 1rem;
  padding: 0.8rem;
  background: #d1ecf1;
  border-radius: 6px;
  color: #0c5460;
  font-size: 0.9rem;
}

.comparison {
  margin: 2rem 0;
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.comparison h3 {
  color: #333;
  margin-bottom: 1.5rem;
}

.comparison-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.comparison-item {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.comparison-item h4 {
  color: #667eea;
  margin-bottom: 1rem;
}

.comparison-item pre {
  margin: 0;
  background: #2d3748;
  padding: 1rem;
  border-radius: 6px;
  overflow-x: auto;
}

.comparison-item code {
  color: #a0aec0;
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  line-height: 1.6;
}

.code-explanation {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.code-explanation h4 {
  color: #667eea;
  margin-bottom: 1rem;
}

.code-explanation ul {
  list-style: none;
  padding: 0;
}

.code-explanation li {
  padding: 0.5rem 0;
  color: #555;
  line-height: 1.6;
}

.code-block {
  margin: 2rem 0;
  background: #2d3748;
  padding: 1.5rem;
  border-radius: 8px;
  overflow-x: auto;
}

.code-block h3 {
  color: white;
  margin-bottom: 1rem;
}

.code-block pre {
  margin: 0;
}

.code-block code {
  color: #a0aec0;
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  line-height: 1.6;
}

.tips-box {
  background: #d4edda;
  padding: 1.5rem;
  border-radius: 8px;
  border-left: 4px solid #28a745;
  margin-top: 2rem;
}

.tips-box h3 {
  color: #155724;
  margin-bottom: 1rem;
}

.tips-box ul {
  list-style: none;
  padding: 0;
}

.tips-box li {
  padding: 0.5rem 0;
  color: #155724;
}

.tips-box strong {
  color: #0c3d1a;
}

@media (max-width: 768px) {
  .code-demo,
  .comparison-grid {
    grid-template-columns: 1fr;
  }
}
</style>
