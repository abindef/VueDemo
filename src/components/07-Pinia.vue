<template>
  <div class="demo-container">
    <h2>7ï¸âƒ£ Pinia çŠ¶æ€ç®¡ç†</h2>
    <p class="intro">Pinia æ˜¯ Vue 3 æ¨èçš„çŠ¶æ€ç®¡ç†åº“ï¼Œæä¾›ç®€å•ã€ç±»å‹å®‰å…¨çš„ API</p>

    <div class="demo-section">
      <h3>ğŸ“Œ Counter Store - åŸºç¡€ç”¨æ³•</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>è®¡æ•°å™¨çŠ¶æ€</h4>
          <p>å½“å‰è®¡æ•°: <strong>{{ counterStore.count }}</strong></p>
          <p>åŒå€è®¡æ•°: <strong>{{ counterStore.doubleCount }}</strong></p>
          <button @click="counterStore.increment()">å¢åŠ </button>
          <button @click="counterStore.decrement()">å‡å°‘</button>
          <button @click="counterStore.reset()">é‡ç½®</button>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>ä½¿ç”¨ <code>defineStore</code> å®šä¹‰ store</li>
            <li><code>state</code> - å­˜å‚¨çŠ¶æ€</li>
            <li><code>getters</code> - è®¡ç®—å±æ€§</li>
            <li><code>actions</code> - ä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•</li>
            <li>ç›´æ¥è®¿é—® store çš„å±æ€§å’Œæ–¹æ³•</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ User Store - ç”¨æˆ·ç®¡ç†</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>ç”¨æˆ·ä¿¡æ¯</h4>
          <div v-if="userStore.isLoggedIn" class="user-info">
            <p>ç”¨æˆ·å: <strong>{{ userStore.user.name }}</strong></p>
            <p>é‚®ç®±: <strong>{{ userStore.user.email }}</strong></p>
            <p>è§’è‰²: <strong>{{ userStore.user.role }}</strong></p>
            <button @click="userStore.logout()">é€€å‡ºç™»å½•</button>
          </div>
          <div v-else class="login-form">
            <input v-model="username" placeholder="ç”¨æˆ·å" />
            <input v-model="email" placeholder="é‚®ç®±" />
            <button @click="handleLogin">ç™»å½•</button>
          </div>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>ç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€</li>
            <li>ä½¿ç”¨ getters è®¡ç®—æ´¾ç”ŸçŠ¶æ€</li>
            <li>actions å¯ä»¥æ˜¯å¼‚æ­¥çš„</li>
            <li>å¤šä¸ªç»„ä»¶å…±äº«çŠ¶æ€</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ Todo Store - å¾…åŠäº‹é¡¹</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>å¾…åŠåˆ—è¡¨</h4>
          <div class="todo-input">
            <input 
              v-model="newTodo" 
              @keyup.enter="handleAddTodo"
              placeholder="è¾“å…¥å¾…åŠäº‹é¡¹..."
            />
            <button @click="handleAddTodo">æ·»åŠ </button>
          </div>
          
          <div class="todo-stats">
            <p>æ€»æ•°: {{ todoStore.todos.length }}</p>
            <p>å·²å®Œæˆ: {{ todoStore.completedCount }}</p>
            <p>æœªå®Œæˆ: {{ todoStore.uncompletedCount }}</p>
          </div>
          
          <div class="todo-list">
            <div 
              v-for="todo in todoStore.todos" 
              :key="todo.id"
              class="todo-item"
              :class="{ completed: todo.completed }"
            >
              <input 
                type="checkbox" 
                :checked="todo.completed"
                @change="todoStore.toggleTodo(todo.id)"
              />
              <span>{{ todo.text }}</span>
              <button @click="todoStore.removeTodo(todo.id)">åˆ é™¤</button>
            </div>
          </div>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>ç®¡ç†å¤æ‚çš„åˆ—è¡¨çŠ¶æ€</li>
            <li>ä½¿ç”¨ getters è®¡ç®—ç»Ÿè®¡ä¿¡æ¯</li>
            <li>actions å¤„ç†ä¸šåŠ¡é€»è¾‘</li>
            <li>çŠ¶æ€æŒä¹…åŒ–ï¼ˆå¯é€‰ï¼‰</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h3>ğŸ“Œ Store ä¹‹é—´çš„é€šä¿¡</h3>
      <div class="code-demo">
        <div class="demo-box">
          <h4>ç»„åˆä½¿ç”¨å¤šä¸ª Store</h4>
          <div class="store-info">
            <p>è®¡æ•°å™¨: {{ counterStore.count }}</p>
            <p>ç”¨æˆ·: {{ userStore.isLoggedIn ? userStore.user.name : 'æœªç™»å½•' }}</p>
            <p>å¾…åŠæ•°: {{ todoStore.todos.length }}</p>
          </div>
          <button @click="resetAll">é‡ç½®æ‰€æœ‰çŠ¶æ€</button>
        </div>
        <div class="code-explanation">
          <h4>ğŸ’¡ è¯´æ˜ï¼š</h4>
          <ul>
            <li>å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨å¤šä¸ª store</li>
            <li>Store ä¹‹é—´å¯ä»¥ç›¸äº’è°ƒç”¨</li>
            <li>ä¿æŒçŠ¶æ€çš„ç‹¬ç«‹æ€§</li>
            <li>ä¾¿äºæ¨¡å—åŒ–ç®¡ç†</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="code-block">
      <h3>ğŸ“ Pinia Store å®šä¹‰ç¤ºä¾‹</h3>
      <pre><code>// stores/counter.js
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', {
  // State
  state: () => ({
    count: 0
  }),
  
  // Getters (è®¡ç®—å±æ€§)
  getters: {
    doubleCount: (state) => state.count * 2
  },
  
  // Actions (æ–¹æ³•)
  actions: {
    increment() {
      this.count++
    },
    decrement() {
      this.count--
    },
    reset() {
      this.count = 0
    }
  }
})

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { useCounterStore } from '@/stores/counter'

const counterStore = useCounterStore()
counterStore.increment()  // è°ƒç”¨ action
console.log(counterStore.count)  // è®¿é—® state
console.log(counterStore.doubleCount)  // è®¿é—® getter</code></pre>
    </div>

    <div class="tips-box">
      <h3>ğŸ¯ Pinia ä¼˜åŠ¿</h3>
      <ul>
        <li><strong>ç®€å•ç›´è§‚ï¼š</strong>API ç®€å•ï¼Œæ˜“äºå­¦ä¹ </li>
        <li><strong>ç±»å‹å®‰å…¨ï¼š</strong>å®Œæ•´çš„ TypeScript æ”¯æŒ</li>
        <li><strong>æ¨¡å—åŒ–ï¼š</strong>æ¯ä¸ª store éƒ½æ˜¯ç‹¬ç«‹çš„</li>
        <li><strong>DevToolsï¼š</strong>å¼ºå¤§çš„å¼€å‘è€…å·¥å…·æ”¯æŒ</li>
        <li><strong>è½»é‡çº§ï¼š</strong>ä½“ç§¯å°ï¼Œæ€§èƒ½å¥½</li>
        <li><strong>æ”¯æŒæ’ä»¶ï¼š</strong>å¯æ‰©å±•æ€§å¼º</li>
      </ul>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { useCounterStore } from '../stores/counter'
import { useUserStore } from '../stores/user'
import { useTodoStore } from '../stores/todo'

const counterStore = useCounterStore()
const userStore = useUserStore()
const todoStore = useTodoStore()

const username = ref('')
const email = ref('')

const handleLogin = () => {
  if (username.value && email.value) {
    userStore.login({
      name: username.value,
      email: email.value,
      role: 'å¼€å‘è€…'
    })
    username.value = ''
    email.value = ''
  }
}

const newTodo = ref('')

const handleAddTodo = () => {
  if (newTodo.value.trim()) {
    todoStore.addTodo(newTodo.value)
    newTodo.value = ''
  }
}

const resetAll = () => {
  counterStore.reset()
  userStore.logout()
  todoStore.todos = []
  console.log('æ‰€æœ‰çŠ¶æ€å·²é‡ç½®')
}
</script>

<style scoped>
.demo-container {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

h2 {
  color: #667eea;
  margin-bottom: 1rem;
  font-size: 2rem;
}

.intro {
  color: #666;
  font-size: 1.1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #667eea;
}

.demo-section {
  margin: 2rem 0;
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.demo-section h3 {
  color: #333;
  margin-bottom: 1rem;
}

.code-demo {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-top: 1rem;
}

.demo-box {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.demo-box h4 {
  color: #667eea;
  margin-bottom: 1rem;
}

.demo-box p {
  margin: 0.5rem 0;
  color: #555;
}

.demo-box strong {
  color: #667eea;
  font-size: 1.2rem;
}

.demo-box button {
  margin: 0.5rem 0.5rem 0 0;
  padding: 0.6rem 1.2rem;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s;
}

.demo-box button:hover {
  background: #5568d3;
  transform: translateY(-2px);
}

.demo-box input {
  width: 100%;
  padding: 0.6rem;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  margin: 0.5rem 0;
  font-size: 1rem;
}

.demo-box input:focus {
  outline: none;
  border-color: #667eea;
}

.user-info {
  padding: 1rem;
  background: #e8f4f8;
  border-radius: 6px;
  border-left: 4px solid #667eea;
}

.login-form {
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 6px;
}

.todo-input {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.todo-input input {
  flex: 1;
  margin: 0;
}

.todo-input button {
  margin: 0;
}

.todo-stats {
  display: flex;
  gap: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 6px;
  margin-bottom: 1rem;
}

.todo-stats p {
  margin: 0;
}

.todo-list {
  max-height: 300px;
  overflow-y: auto;
}

.todo-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.8rem;
  background: #f8f9fa;
  margin: 0.5rem 0;
  border-radius: 6px;
  transition: all 0.3s;
}

.todo-item:hover {
  background: #e8f4f8;
}

.todo-item.completed span {
  text-decoration: line-through;
  opacity: 0.6;
}

.todo-item input[type="checkbox"] {
  width: auto;
  margin: 0;
}

.todo-item span {
  flex: 1;
  color: #555;
}

.todo-item button {
  padding: 0.4rem 0.8rem;
  font-size: 0.85rem;
  background: #dc3545;
  margin: 0;
}

.store-info {
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 6px;
  margin-bottom: 1rem;
}

.code-explanation {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.code-explanation h4 {
  color: #667eea;
  margin-bottom: 1rem;
}

.code-explanation ul {
  list-style: none;
  padding: 0;
}

.code-explanation li {
  padding: 0.5rem 0;
  color: #555;
  line-height: 1.6;
}

.code-explanation code {
  background: #f8f9fa;
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  color: #667eea;
  font-family: 'Courier New', monospace;
}

.code-block {
  margin: 2rem 0;
  background: #2d3748;
  padding: 1.5rem;
  border-radius: 8px;
  overflow-x: auto;
}

.code-block h3 {
  color: white;
  margin-bottom: 1rem;
}

.code-block pre {
  margin: 0;
}

.code-block code {
  color: #a0aec0;
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  line-height: 1.6;
}

.tips-box {
  background: #d4edda;
  padding: 1.5rem;
  border-radius: 8px;
  border-left: 4px solid #28a745;
  margin-top: 2rem;
}

.tips-box h3 {
  color: #155724;
  margin-bottom: 1rem;
}

.tips-box ul {
  list-style: none;
  padding: 0;
}

.tips-box li {
  padding: 0.5rem 0;
  color: #155724;
}

.tips-box strong {
  color: #0c3d1a;
}

@media (max-width: 768px) {
  .code-demo {
    grid-template-columns: 1fr;
  }
  
  .todo-stats {
    flex-direction: column;
    gap: 0.5rem;
  }
}
</style>
